cjModules.define(function(){"use strict";return function(e,a){function t(e){if(e.shortcutId){var t=cjgShortcuts.getUrl(e.shortcutId,a.account);if(t)return void a.openTab(t)}e.url&&a.openTab(e.url)}function n(e,n){function i(n){n[_]||1===n.button?t(o):a.pageManager.navigate(e),n.preventDefault(),n.stopPropagation()}var o=a.servicesDatabase[e],c=o.iconName||"placeholder";a.darkMode&&"googleg"===c&&(c="search");var s=mdElements.createElement("item",{icon:{serviceName:c},label:o.label});if(s.classList.add("bm-p-portal-pageitem","bm-p-portal-page"),s.dataset.id=e,s.style.color=o.color||(a.darkMode?"rgba(255, 255, 255, 0.8)":"#212121"),o.color&&(s.style.color=o.color),n){s.draggable=!0;var r=mdElements.createElement("icon",{name:"__mdi:drag_indicator",size:20});r.classList.add("bm-p-portal-pageitem__dragicon"),s.appendChild(r);var l=function(t){a.userServices.remove(e),t.stopPropagation()},d=mdElements.createElement("iconbutton",{iconName:"__mdi:delete",label:cjBasics.lang.i18n("cj_i18n_01164","Remove from menu")});d.addEventListener("click",l),d.addEventListener("dblclick",l),d.addEventListener("auxclick",l),d.classList.add("bm-p-portal-pageitem__remove"),s.appendChild(d),s.addEventListener("dragstart",function(t){a.pageManager.navigate("removedialog"),t.dataTransfer.setData("serviceId",e)})}if(s.addEventListener("click",i),s.addEventListener("touchstart",i,{passive:!0}),s.addEventListener("auxclick",i),o.shortcutId||o.url){var p=mdElements.createElement("iconbutton",{iconName:"__mdi:open_in_new",label:cjBasics.lang.i18n("cj_i18n_00084","Open service in new tab"),onClick:function(e){t(o),e.stopPropagation()}});p.classList.add("bm-p-portal-pageitem__open-in-new"),s.appendChild(p)}return s}function i(e){e===f?a.pageManager.navigate(b):a.pageManager.navigate(e)}function o(){var e=mdElements.createElement("appbar"),t=mdElements.createElement("iconbutton",{iconName:"__mdi:apps",onClick:function(){i("applauncher")}});t.classList.add("bm-p-portal-pageicon","bm-p-portal-page"),t.dataset.id="applauncher",e.appendChild(t);var n=mdElements.createElement("iconbutton",{iconName:"__mdi:settings",onClick:function(){i("blackmenusettings")}});if(n.classList.add("bm-p-portal-pageicon","bm-p-portal-page"),n.dataset.id="blackmenusettings",e.appendChild(n),a.account.validSession){var o=mdElements.createElement("iconbutton",{iconName:"__mdi:notifications",onClick:function(e){i("notifications"),e.stopPropagation()}});o.dataset.id="notifications",o.classList.add("bm-p-portal-notificationbutton","bm-p-portal-pageicon","bm-p-portal-page"),e.insertBefore(o,n);var c=cjgApis.session.account.pageId?cjBasics.lang.i18n("cj_i18n_00363","Brand account"):cjgApis.session.account.displayEmail,s=cjgApis.session.account.displayName+"\n"+c,r=mdElements.createElement("iconbutton",{label:s,icon:{size:32,circle:!0,url:cjgApis.session.account.photoUrl+"?sz="+Math.ceil(32*window.devicePixelRatio),backupUrl:"/images/avatar.svg"},onClick:function(){i("accountchooser")}});r.dataset.id="accountchooser",r.classList.add("bm-p-portal-pageicon","bm-p-portal-page"),e.appendChild(r),cjgApis.ogs.getNotificationsCount(a.account).then(function(e){e&&(o.dataset.count=e)}),cjgApis.info.getIsOne(a.account).then(function(e){e&&r.classList.add("bm-p-portal-accountbutton--one")})}else{var l=mdElements.createElement("button",{label:cjBasics.lang.i18n("cj_i18n_01544","Sign in"),fill:!0,color:!0,onClick:function(){cjgApis.account.signin(a.account)}});l.classList.add("bm-p-portal-signin"),e.appendChild(l)}return e}function c(){var e=(window.location.search.indexOf("debug")!==-1||!a.account.pageId)&&"customize"===f,t=document.createDocumentFragment();d.forEach(function(i){if(a.servicesDatabase[i]){var o=n(i,e);t.appendChild(o)}}),m.textContent="",s(f),m.appendChild(t),s(f)}function s(e){var a=document.querySelector(".bm-p-portal-activepage");a&&a.classList.remove("bm-p-portal-activepage");var t=document.querySelector(".bm-p-portal-page[data-id='"+e+"']");if(t&&(t.classList.add("bm-p-portal-activepage"),t.classList.contains("bm-p-portal-pageitem"))){var n=p.scrollTop,i=t.offsetTop,o=i-60;if(n>o)p.scrollTop=o;else{var c=i-p.offsetHeight-4;n<c&&(p.scrollTop=c)}}}function r(e){var t=d.indexOf(f),n=t+(e?-1:1),i=d[n];i||(i=e?d[d.length-1]:d[0]),a.pageManager.navigate(i)}function l(){a.darkMode&&e.classList.add("cj-md--dark");var t=o();e.appendChild(t),p=mdElements.createElement("container",{scrollable:!0,shadow:"transparentOnScroll"}),window.addEventListener("dragleave",function(e){0===e.y&&"removedialog"===f&&a.pageManager.navigate("customize")}),m=document.createElement("ul"),m.className="bm-p-portal-pagelist",p.appendChild(m),m.addEventListener("dragover",function(e){e.preventDefault()}),m.addEventListener("drop",function(e){e.preventDefault(),a.pageManager.navigate("customize");var t=e.dataTransfer.getData("serviceId");"customize"!==f&&a.pageManager.navigate(t);var n=e.target,i=n;e.offsetY>24&&n.nextSibling&&(i=n.nextSibling);var o=i.dataset.id,c=d.indexOf(o);if(n===m||c===-1)a.userServices.add(t);else{var s=d.indexOf(t);s!==-1&&d.splice(s,1),d.splice(c,0,t),a.userServices.set(d)}}),a.userServices.onChange(function(e){d=e,c()}),a.pageManager.onChange(function(e){if(e!==f){var a="removedialog"!==e&&("customize"===e||"customize"===f);f=e,h.indexOf(e)===-1&&(b=e),a&&(u(),c(),m.classList.toggle("bm-p-portal-pagelist--customize","customize"===e)),s(e),setTimeout(function(){s(e)})}}),e.appendChild(p);var n=document.createElement("div");n.className="bm-p-portal-page bm-p-portal-customize",n.dataset.id="customize";var i=mdElements.createElement("icon",{name:"__mdi:edit",color:a.darkMode?null:"rgba(0, 0, 0, 0.54)"});i.classList.add("bm-p-portal-customize__icon"),n.appendChild(i);var l=mdElements.createElement("icon",{name:"__mdi:done",color:a.darkMode?null:"#1a73e8"});l.hidden=!0,l.classList.add("bm-p-portal-customize__icon"),n.appendChild(l);var _=document.createElement("div"),E=cjBasics.lang.i18n("cj_i18n_01713","Customize"),C=cjBasics.lang.i18n("cj_i18n_01715","Finish");_.textContent=E,_.className="bm-p-portal-customize__label",n.appendChild(_),a.account.pageId?(n.title=cjBasics.lang.i18n("cj_i18n_01714","Customize is not available for brand accounts"),n.classList.add("bm-p-portal-customize--disabled")):(u=function(){g="customize"===f,i.hidden=g,l.hidden=!g,_.textContent=g?C:E},n.addEventListener("click",function(){g="customize"===f,a.pageManager.navigate(g?b:"customize")})),e.appendChild(n),v.commands.onCommand.addListener(function(e){"portal-next-page"===e?r(!1):"portal-previous-page"===e&&r(!0)})}var d,p,m,u,g,v="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,f="search",b="search",h=["applauncher","customize","notifications","blackmenusettings","accountchooser","removedialog"],_=cjBasics.navigator.metaKeyName;l()}});