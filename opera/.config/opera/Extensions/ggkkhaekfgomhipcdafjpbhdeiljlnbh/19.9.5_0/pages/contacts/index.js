cjModules.define(function(){"use strict";return function(e,t){function n(){return cjgApis.info.getIsConsumerGmail(t.account)?Promise.resolve(!1):cjgApis.cache.getItem(t.account,"bm_pref__contacts__directory").then(function(e){return"boolean"==typeof e?e:h().then(function(){return!0},function(){return!1}).then(function(e){cjgApis.cache.setItem(t.account,"bm_pref__contacts__directory",e)})})}function a(t,n){H=0,bmElements.setLoading(e,!0),V=t,J=n,ae&&y()}function c(){Promise.all([cjgApis.cache.getItem(t.account,"bm_cache_v05__contacts__library"),X]).then(function(e){ae||(B=e[0],B&&(ae=!0,y()))}),Promise.all([ne,X]).then(function(e){var t=b(Q?"LAST_NAME_ASCENDING":"FIRST_NAME_ASCENDING");return te?Promise.all([h().then(d),t]).then(function(e){var t=e[0],n=e[1],a=t.map(function(e){return e.id});return n.forEach(function(e){a.indexOf(e.id)===-1&&t.push(e)}),C(t),t}):t}).then(function(e){ae=!0,B&&JSON.stringify(B).length===JSON.stringify(e).length||(cjgApis.cache.setItem(t.account,"bm_cache_v05__contacts__library",e),B=e,y())})}function o(e,n){var a=cjBasics.urlParams.attach(F+e,n);return cjgApis.request(a,{fetchAs:"json"},{account:t.account,requiredScopes:U})["catch"](function(){return new Promise(function(t){setTimeout(function(){o(e,n).then(t)},4e3)})})}function r(){var e="https://www.google.com/contacts/?authuser="+t.account.authuser+"#contact/new";t.openTab(e)}function i(e){var t=Q?e.displayNameLastFirst:e.displayName,n={withShell:!0,size:q};e.photo?(n.url=e.photo+"?sz="+$,n.color="#fff"):n.symbol=t[0]||" ";var a=mdElements.createElement("item",{icon:n,label:t});a.classList.add("bm-p-contacts-listitem"),a.cjceContactsData=e;var c=mdElements.createElement("iconbutton",{iconName:"__mdi:edit",onClick:function(){L(e.id,!0)}});c.classList.add("bm-p-contacts-listitem__tool"),a.appendChild(c);var o=mdElements.createElement("iconbutton",{iconName:"__mdi:open_in_new",onClick:function(){L(e.id)}});return o.classList.add("bm-p-contacts-listitem__tool"),a.appendChild(o),a}function s(e){return mdElements.createElement("emptystate",{color:D,label:cjBasics.lang.i18n("cj_i18n_01275","No contacts found"),subLabel:"search"===e?cjBasics.lang.i18n("cj_i18n_00116","Try a synonym or more general keyword"):null,iconName:"search"===e?"__mdi:search":"__mdi:contacts_product"})}function l(e){var t=e.resourceName;if(!te||!t.startsWith("people/c"))return t;var n=e.metadata&&e.metadata.sources;if(!Array.isArray(n))return t;for(var a=0;a<n.length;a++)if("DOMAIN_PROFILE"===n[a].type)return"people/"+n[a].id;return t}function m(e){var t=l(e),n=e&&e.names&&e.names[0]||ce[t];if(n){var a=n.displayName||"",c=n.displayNameLastFirst||a;if(a)return{id:t,displayName:a,displayNameLastFirst:c,sortValue:a.toLowerCase(),sortValueLastFirst:c.toLowerCase(),photo:e.photos?e.photos[0].url:null,memberships:Array.isArray(e.memberships)?e.memberships.map(function(e){return e.contactGroupMembership?e.contactGroupMembership.contactGroupId:"GSUITE_DIRECTORY_GROUP"}):[]}}}function d(e){for(var t=[],n=[],a=0;a<e.length;a+=50){var c=o("people:batchGet",{resourceNames:e.splice(0,50),fields:"responses(requestedResourceName,person(names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId))",personFields:"names,photos,memberships",prettyPrint:"false"}).then(function(e){e.responses.forEach(function(e){e.person.resourceName=e.requestedResourceName;var n=m(e.person);n&&t.push(n)})});n.push(c)}return Promise.all(n).then(function(){return t})}function u(e){var t=e.id&&e.id.$t&&e.id.$t.split("full/P.")[1];if(!t)return null;for(var n=cjBasics.numbers.hex2dec(t);n.length<20;)n="0"+n;return n.length<21&&(n="1"+n),n}function p(e,t){var n=t.gd$name;if(n){var a=n.gd$fullName&&n.gd$fullName.$t,c=n.gd$givenName&&n.gd$givenName.$t,o=n.gd$familyName&&n.gd$familyName.$t,r=a||c||o,i=o&&c?o+", "+c:null;ce[e]={displayName:r,displayNameLastFirst:i}}}function h(){return ee||(ee=f()),ee}function f(){var e=cjBasics.urlParams.attach(R+"gal/default/full",{alt:"json","max-results":"50000"});return cjgApis.request(e,{fetchAs:"json",headers:{"GData-Version":"1.0"}},{account:t.account,requiredScopes:U}).then(function(e){var t=[],n=e&&e.feed&&e.feed.entry;return Array.isArray(n)?(n.forEach(function(e){var n=u(e);if(n){var a="people/"+n;p(a,e),t.push(a)}}),t):t})}function b(e,t,n){var a=t||[];return o("people/me/connections",{pageToken:n,pageSize:"2000",prettyPrint:"false",personFields:"memberships,metadata,names,photos",fields:Z,sortOrder:e}).then(function(t){if(!Array.isArray(t.connections))return a;t.connections.forEach(function(e){var t=m(e);t&&a.push(t)});var n=t.nextPageToken;return n=!1,n?b(e,a,n):a})}function _(e){return B.filter(function(t){return t.memberships.indexOf(e)!==-1})}function g(e){return B.filter(function(t){return JSON.stringify(t).indexOf(e)!==-1})}function v(e,t){var n=document.createDocumentFragment();t.forEach(function(e){var t=i(e);n.appendChild(t)}),e.appendChild(n)}function y(){function t(e){a=null,H+=W;var c=n.splice(0,e?H:W);v(m,c),n.length&&(a=t)}bmElements.setLoading(e,!0);var n,a=null,c=mdElements.createElement("container",{scrollable:!0,shadow:"thinOnScroll",onScrollBottom:function(){a&&a()}});if("home"===V){var o=_("starred");if(o.length>0){var r=mdElements.createElement("subheader",{color:D,label:cjBasics.lang.i18n("cj_i18n_00004","Starred")});c.appendChild(r);var i=mdElements.createElement("list");v(i,o),c.appendChild(i);var l=mdElements.createElement("subheader",{color:D,label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")});c.appendChild(l)}n=_("myContacts")}else"search"===V?n=g(J):"directory"===V?n=_("GSUITE_DIRECTORY_GROUP"):"label"===V&&(n=_(J));var m;if(n.length>0)m=mdElements.createElement("list"),t(!0),c.appendChild(m);else{var d=s(V);c.appendChild(d)}G.textContent="",G.appendChild(c),bmElements.setLoading(e,!1)}function E(e,t){var n=t.resourceName.replace("contactGroups/",""),a=t.formattedName,c=a,o=t.memberCount;o>0&&(c+=" ("+o+")"),e.push({id:n,iconName:"__mdi:label",label:c,navigatorLabel:a,newTabUrl:O+"label/"+n+"#"+(K[n]||"contacts/group/"+n+"/"+a)})}function C(e){var t=Q?"sortValueLastFirst":"sortValue";e.sort(function(e,n){return e[t]<n[t]?-1:1})}function N(e){Q=e,browserStorage.sync.setItem("bm_pref__contacts__lastname",Q),ae&&(C(B),y())}function j(){bmElements.setLoading(I,!0);var e=[{id:"home",label:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),navigatorLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),iconName:"__mdi:person",newTabUrl:O,divider:!0}],n=[{label:cjBasics.lang.i18n("cj_i18n_01276","Frequently contacted"),iconName:"__mdi:history",newTabUrl:O+"frequent#contacts/group/26ad/Most+Contacted",external:!0},{label:cjBasics.lang.i18n("cj_i18n_01277","Duplicates"),iconName:"__mdi:content_copy",newTabUrl:O+"merge",external:!0},{label:cjBasics.lang.i18n("cj_i18n_01278","Other contacts"),iconName:"__mdi:archive",newTabUrl:O+"other#contacts/group/26ae/Other+Contacts",external:!0,divider:!0}],c=document.createElement("div");I.appendChild(c);var r=o("contactGroups",{pageSize:"500",fields:"contactGroups(resourceName,groupType,formattedName,memberCount)",prettyPrint:"false"});Promise.all([r,X,ne]).then(function(o){var r=[];te&&(e[0].divider=!1,e.push({id:"directory",label:cjBasics.lang.i18n("cj_i18n_01279","Directory"),iconName:"__mdi:business",newTabUrl:O+"directory",divider:!0})),o[0].contactGroups.forEach(function(t){if("USER_CONTACT_GROUP"===t.groupType)E(r,t);else if("contactGroups/myContacts"===t.resourceName){var n=t.memberCount;n>0&&(e[0].label+=" ("+n+")")}else Y.indexOf(t.resourceName)!==-1&&t.memberCount>0&&E(r,t)}),r.length>0&&(e.push({header:!0,label:cjBasics.lang.i18n("cj_i18n_01280","Labels")}),r.sort(function(e,t){return e.label.toLowerCase()<t.label.toLowerCase()?-1:1}),r[r.length-1].divider=!0,e=e.concat(r)),e=e.concat(n),P=bmElements.createElement("navlist",{compact:!0,isSelector:!0,selectedId:"home",items:e,onChange:function(e,t){z=t.newTabUrl||O,"home"===e||"directory"===e?a(e):a("label",e),M.cjceSetPageLabel(t.navigatorLabel||t.label)},onNewTab:function(e,n){t.openTab(n.newTabUrl)}}),c.appendChild(P);var i=bmElements.createElement("drawerdropdown",{iconName:"__mdi:cj_sort_by_alpha",label:cjBasics.lang.i18n("cj_i18n_01281","Sort"),selectedId:Q?"last":"first",items:[{value:"last",label:cjBasics.lang.i18n("last","Sort by last name")},{value:"first",label:cjBasics.lang.i18n("cj_i18n_01283","Sort by first name")}],onChange:function(){N("last"===i.cjceSelectedId)}});I.appendChild(i),bmElements.setLoading(I,!1)})}function w(e){var t=mdElements.createElement("item");e.onClick?t.addEventListener("click",function(){e.onClick()}):t.classList.add("no-action");var n=mdElements.createElement("icon",{name:e.iconName});t.appendChild(n);var a=document.createElement("div");a.className="cj-md-item__body",t.appendChild(a);var c=document.createElement("div");if(c.className="cj-md-item__header",c.textContent=e.value,a.appendChild(c),e.subLabel){var o=mdElements.createElement("secondarytext",{label:e.subLabel});a.appendChild(o)}return t}function L(e,n){var a=O+e.replace("people/","person/");n&&(a+="?edit=true"),e.startsWith("people/c")&&(a+="#contact/"+cjBasics.numbers.dec2hex(e.replace("people/c",""))),t.openTab(a)}function A(n){var a=mdElements.createElement("container",{solid:!0,darkMode:t.darkMode});a.classList.add("bm-p-contacts-details"),bmElements.setLoading(a,!0);var c=bmElements.createElement("ogb",{color:"transparent",floating:!0,darkMode:t.darkMode,displayBack:!0,onBack:function(){a.remove()},bmApis:t,onNewTab:function(){L(n.id)}});a.appendChild(c);var r=mdElements.createElement("iconbutton",{iconName:"__mdi:edit",onClick:function(){L(n.id,!0)}});c.cjceAppendChild(r);var i=document.createElement("div");i.className="bm-p-contacts-details__top",a.appendChild(i);var s=Q?n.displayNameLastFirst:n.displayName,l=80,m=Math.ceil(l*window.devicePixelRatio),d={withShell:!0,size:l};n.photo?(d.url=n.photo+"?sz="+m,d.color="#b3b3b3"):d.symbol=s[0]||" ";var u=mdElements.createElement("icon",d);u.classList.add("bm-p-contacts-details__photo"),i.appendChild(u);var p=mdElements.createElement("title",{label:s});p.classList.add("bm-p-contacts-details__name"),i.appendChild(p);var h=mdElements.createElement("container",{scrollable:!0,shadow:"thickOnScroll"});a.appendChild(h);var f=mdElements.createElement("list");h.appendChild(f),o(n.id,{prettyPrint:"false",fields:"addresses,birthdays,emailAddresses,phoneNumbers"}).then(function(e){var n=document.createDocumentFragment();if(Array.isArray(e.emailAddresses)&&e.emailAddresses.length>0&&e.emailAddresses.forEach(function(e){var a=w({iconName:"__mdi:email",value:e.value,subLabel:e.formattedType,onClick:function(){t.openTab("mailto:"+e.value)}});n.appendChild(a)}),Array.isArray(e.phoneNumbers)&&e.phoneNumbers.length>0&&e.phoneNumbers.forEach(function(e){var a=w({iconName:"__mdi:call",value:e.value,subLabel:e.formattedType,onClick:function(){t.openTab(cjBasics.urlParams.attach("https://hangouts.google.com/",{authuser:t.account.authuser,pn:e.canonicalForm,action:"chat"}))}});n.appendChild(a)}),Array.isArray(e.addresses)&&e.addresses.length>0&&e.addresses.forEach(function(e){var a=w({iconName:"__mdi:place",value:e.formattedValue,subLabel:e.formattedType,onClick:function(){t.openTab(cjBasics.urlParams.attach("https://maps.google.com/",{authuser:"0"===t.account.authuser?null:t.account.authuser,q:e.formattedValue}))}});n.appendChild(a)}),Array.isArray(e.birthdays)&&e.birthdays.length>0&&e.birthdays.forEach(function(e){var t=w({iconName:"__mdi:cake",value:e.text});n.appendChild(t)}),0===n.children.length){var c=document.createElement("div");c.className="bm-p-contacts-noinfo",c.textContent=cjBasics.lang.i18n("cj_i18n_01284","No more contact info found"),n.appendChild(c)}f.appendChild(n),bmElements.setLoading(a,!1)}),e.appendChild(a)}function T(e){var n=encodeURIComponent(e),a=O+"search/"+n+"#contacts/search/"+n;t.openTab(a)}function k(){var e=P.cjceSelectedId;"home"===e||"directory"===e?a(e):a("label",e)}function S(){bmElements.setLoading(e,!0),M=bmElements.createElement("ogb",{darkMode:t.darkMode,drawer:{color:D},serviceIcon:"contacts",serviceLabel:cjBasics.lang.i18n("cj_i18n_00314","Contacts"),pageLabel:cjBasics.lang.i18n("cj_i18n_00291","Home"),searchbox:{color:D,onClear:k,onInput:function(e){e?a("search",e):k()},onSubmit:function(){G.querySelector(".cj-md-item").click()},onSubmitAlt:T},bmApis:t,onNewTab:function(){"search"===V?T(J):t.openTab(z)}}),e.appendChild(M),I=M.cjceDrawerEle,x=M.cjceSearchboxEle;var n=bmElements.createElement("fab",{darkMode:t.darkMode,label:cjBasics.lang.i18n("cj_i18n_01285","Create contact"),onClick:r});e.appendChild(n),t.onPageDisplay(x.select),G=mdElements.createElement("container",{darkMode:t.darkMode}),G.addEventListener("click",function(e){var t=e.target.cjceContactsData;t&&A(t)}),e.appendChild(G),c(),j(),cjgApis.auth.requireToken(t.account,U)["catch"](function(n){var a=bmElements.createElement("fulldialog",{darkMode:t.darkMode,bmApis:t,onNewTab:function(){t.openTab(z)},lockup:{label:cjBasics.lang.i18n("cj_i18n_00314","Contacts")},iconName:"contacts",message:cjBasics.lang.i18n("cj_i18n_01286","Before you can use this page, you need to give access to load your Google Contacts"),actionLabel:cjBasics.lang.i18n("cj_i18n_01178","Continue"),action:function(){cjgApis.auth.requestPermissions(t.account,n.cjg_missing_scopes)}});e.appendChild(a)})}var B,P,G,I,M,x,O="https://contacts.google.com/"+t.wizPath,F="https://people.googleapis.com/v1/",R="https://www.google.com/m8/feeds/",U=["https://www.googleapis.com/auth/contacts.readonly"],D="#1a73e8",q=40,$=Math.ceil(q*window.devicePixelRatio),z=O,V="home",J=null,H=0,W=25,Y=["contactGroups/coworkers","contactGroups/family","contactGroups/friends"],K={friends:"contacts/group/d/Friends",family:"contacts/group/e/Family",coworkers:"contacts/group/e/Coworkers"},Q=!1,X=browserStorage.sync.getItem("bm_pref__contacts__lastname").then(function(e){Q=Boolean(e)}),Z="connections(resourceName,names(displayName,displayNameLastFirst),photos/url,memberships/contactGroupMembership/contactGroupId),nextPageToken",ee=null,te=!1,ne=n().then(function(e){e&&(te=!0,Z=Z.replace("resourceName,","resourceName,metadata/sources(type,id),"))}),ae=!1,ce={};S()}});