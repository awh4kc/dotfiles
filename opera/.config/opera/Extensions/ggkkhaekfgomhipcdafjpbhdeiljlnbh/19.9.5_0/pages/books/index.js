cjModules.define(function(){"use strict";return function(e,a,n){function t(e){return"https://play.google.com/"+e+"?authuser="+a.account.authuser}function o(e){return cjBasics.urlParams.attach("https://books.google.com/books",{as_coll:e,authuser:a.account.authuser})}function s(e){return G[e].shelfId}function i(n){if(n&&"not_authorized"===n.cjg_error){e.textContent="";var t=bmElements.createElement("fulldialog",{darkMode:a.darkMode,bmApis:a,onNewTab:function(){a.openTab(z)},lockup:{label:cjBasics.lang.i18n("cj_i18n_00285","Play Books")},iconName:"play_books",message:cjBasics.lang.i18n("cj_i18n_00321","Before you can use this page, you need to give access to load your Google Books. In case you only want to search for books, navigate to the search page in this extension."),actionLabel:cjBasics.lang.i18n("cj_i18n_01178","Continue"),action:function(){cjgApis.auth.requestPermissions(a.account,n.cjg_missing_scopes)}});e.appendChild(t)}}function l(e,n){var t=n||{};t.hl=cjBasics.lang.current,t.prettyPrint="false";var o=cjBasics.urlParams.attach(F+e,t);return cjgApis.request(o,{fetchAs:"json"},{internal:"optional",account:a.account,requiredScopes:H})}function c(e){var n="undefined"!=typeof e.shelf;if(n&&e.noCache!==!0&&7===e.shelf)return cjgApis.cache.getItem(a.account,"bm_cache_v05__books__mybooks").then(function(a){return e.noCache=!0,a?{result:a,newRequest:!0,freshRequest:function(){return c(e)}}:c(e)});e.startIndex=e.startIndex||0;var t="undefined"!=typeof e.shelf,o="";return t&&(o+="mylibrary/bookshelves/"+e.shelf+"/"),o+="volumes",l(o,{q:e.q,maxResults:e.maxResults,fields:"items(id,volumeInfo(title,previewLink,authors))",filter:n?null:e.searchFilter,startIndex:e.startIndex}).then(function(o){var s=o.items,i=[];s&&s.forEach(function(e){var a=e.volumeInfo;i.push({id:e.id,title:a.title,previewLink:a.previewLink,authors:a.authors,openBook:t})});var l={result:i,newRequest:0===e.startIndex};return n&&0===e.startIndex&&7===e.shelf&&cjgApis.cache.setItem(a.account,"bm_cache_v05__books__mybooks",i),o.items=o.items||[],o.totalItems-e.startIndex-o.items.length!==0&&(l.followupRequest=function(){return e.startIndex+=e.maxResults,c(e)}),l},i)}function r(e){return c({maxResults:D,searchFilter:I.selected,shelf:e.shelf,q:e.q}).then(function(e){return B=e.followupRequest,e})}function d(e){var n=M?"https://play.google.com/books/reader":"https://books.google.com/books";return n+"?id="+encodeURIComponent(e.id)+"&authuser="+a.account.authuser}function u(e){var n=mdElements.createElement("griditem");n.addEventListener("click",function(){var n=d(e);a.openTab(n)});var t=cjBasics.urlParams.attach("https://books.google.com/books/reader",{printsec:"frontcover",img:"1",zoom:"1",id:e.id}),o=document.createElement("div");o.className="bm-p-books-thumbnail",o.style.backgroundImage='url("'+t+'")',n.appendChild(o);var s=document.createElement("div");s.className="cj-md-grid__item__bottom",n.appendChild(s);var i=document.createElement("div");i.className="cj-md-grid__item__textcontainer",s.appendChild(i);var l=document.createElement("div");l.textContent=e.title,i.appendChild(l);var c=20;if(Array.isArray(e.authors)){var r=document.createElement("div");r.className="cj-md-secondarytext",r.textContent=e.authors.join(" "),i.appendChild(r)}var u;return e.previewLink&&!e.openBook&&(c-=5,u=mdElements.createElement("iconbutton",{iconName:"__mdi:visibility",label:"Preview",onClick:function(){a.openTab(e.previewLink+"&authuser="+a.account.authuser)}}),s.appendChild(u)),e.title.length>c&&(l.title=e.title),n}function m(){var e=mdElements.createElement("emptystate",{color:Y,label:cjBasics.lang.i18n("cj_i18n_00322","No books found"),iconName:"__mdi:book"});x.appendChild(e)}function b(a){var n=a.result;a.newRequest&&(x.textContent="",T=mdElements.createElement("gridcontainer"),x.appendChild(T),0===n.length&&m()),0!==n.length&&n.forEach(function(e){var a=u(e);T.appendChild(a)}),a.freshRequest?a.freshRequest().then(b):bmElements.setLoading(e,!1)}function h(){U.cjceToggleState(!1),bmElements.setLoading(e,!0),x.textContent="";var a=N.value;C=a,A.hidden=!1,r({q:a}).then(b)}function _(e){var n=cjBasics.urlParams.attach("https://play.google.com/store/search",{q:e,c:"books",authuser:a.account.authuser});a.openTab(n)}function p(e){var n=cjBasics.urlParams.attach("https://www.google.com/search",{q:e,tbm:"bks",authuser:"0"===a.account.authuser?null:a.account.authuser});a.openTab(n)}function f(e){return e.map(function(e){var a=G[e];return a.id=e,a})}function g(){var e=[],a=["eBooks","audiobooks","play","forYou","purchases","uploads","rentals","samples","family","classicbooks"],n=["libraryHeader","eBooks","favorites","readingNow","toRead","haveRead","forYou"],t=["historyHeader","purchases","reviewed","recentlyViewed","browsingHistory"];return M?(e=f(a),Promise.resolve(e)):(e=f(n),l("mylibrary/bookshelves",{fields:"items(id,title,volumeCount)"}).then(function(a){var n=[];a.items.forEach(function(e){if(V.indexOf(e.id)===-1){var a="bookshelf-"+e.id,t={id:a,shelfId:e.id,label:e.title,iconName:"__mdi:newsstand",newTabUrl:o(e.id)};G[a]=t,n.push(t)}}),n.sort(function(e,a){return e.label>a.label?-1:1}),e=e.concat(n);var s=f(t);return e=e.concat(s)}))}function v(e){var n=Date.now();cjgApis.suggestquery.get({gAccount:a.account,hl:cjBasics.lang.current,q:e,ds:"bo"}).then(function(e){if(!(E>n)){if(E=n,q.textContent="",!e)return void U.cjceToggleState(!1);for(var a=0;a<e.length;a++){var t=e[a],o=mdElements.createElement("item");o.dataset.value=t.value,o.appendChild(t.html),q.appendChild(o)}U.cjceToggleState(!0)}})}function j(){var e=mdElements.createElement("appbar",{darkMode:a.darkMode,secondary:!0});e.hidden=!0;var n=mdElements.createElement("flexspace");return e.appendChild(n),I=mdElements.createElement("selectbox",{onChange:h,options:[{value:"ebooks",label:cjBasics.lang.i18n("cj_i18n_00198","All prices"),selected:!0},{value:"free-ebooks",label:cjBasics.lang.i18n("cj_i18n_00199","Free")},{value:"paid-ebooks",label:cjBasics.lang.i18n("cj_i18n_00200","Paid")}]}),e.appendChild(I),e}function k(){B&&B().then(b)}function w(){bmElements.setLoading(R,!0),g().then(function(n){L=bmElements.createElement("navlist",{isSelector:!0,selectedId:"eBooks",compact:!M,items:n,onChange:function(n,t){if("classicbooks"===n||"play"===n){if(L.cjceSelectedId=O,"classicbooks"===n)return void a.pageManager.navigate(n);if("play"===n)return void a.pageManager.navigate(n,{typeId:"books"})}O=n,bmElements.setLoading(e,!0),x.textContent="",t&&(z=t.newTabUrl,P.cjceSetPageLabel(t.label)),r({shelf:s(n)}).then(b)},onNewTab:function(e,n){a.openTab(n.newTabUrl)}}),R.appendChild(L),bmElements.setLoading(R,!1)},i)}function y(){bmElements.setLoading(e,!0),P=bmElements.createElement("ogb",{darkMode:a.darkMode,drawer:{color:Y},serviceIcon:M?"play_books":"books",serviceLabel:M?cjBasics.lang.i18n("cj_i18n_00285","Play Books"):cjBasics.lang.i18n("cj_i18n_00460","Books"),pageLabel:G[O].label,searchbox:{searchmenu:!0,color:Y,onClear:function(){bmElements.setLoading(e,!0),C="",N.clear(),r({shelf:s(O)}).then(b)},submitInNewTab:M,onInput:M?null:v,onSubmit:M?_:h,onSubmitAlt:M?_:p},bmApis:a,onNewTab:function(){return C?void(M?_(C):p(C)):void a.openTab(z)}}),e.appendChild(P),R=P.cjceDrawerEle,N=P.cjceSearchboxEle,U=N.cjceSearchmenuEle,q=mdElements.createElement("list"),q.classList.add("bm-ele-autocomplete"),q.addEventListener("click",function(e){var a=e.target.dataset.value;N.value=a,h(a)}),U.appendChild(q),w(),A=j(),x=mdElements.createElement("container",{darkMode:a.darkMode,scrollable:!0,shadow:"thinOnScroll",onScrollBottom:k}),a.onPageDisplay(N.select),e.appendChild(A),e.appendChild(x),r({shelf:7}).then(b)}var B,E,C,I,T,x,N,U,R,q,L,P,A,S=n.productId||"books",M="books"===S,H=["https://www.googleapis.com/auth/books"],F="https://www.googleapis.com/books/v1/",D=12,Y=M?"#0179CA":"#1a73e8",z="https://play.google.com/books?authuser="+a.account.authuser,O="eBooks",V=[0,1,2,3,4,5,6,7,8,9],G={libraryHeader:{header:!0,color:Y,label:cjBasics.lang.i18n("cj_i18n_00807","My library")},historyHeader:{header:!0,color:Y,label:cjBasics.lang.i18n("cj_i18n_01685","My history")},favorites:{label:cjBasics.lang.i18n("cj_i18n_01369","Favorites"),shelfId:0,iconName:"__mdi:star_outline",newTabUrl:o(0)},purchases:{label:M?cjBasics.lang.i18n("cj_i18n_01679","Purchases"):cjBasics.lang.i18n("cj_i18n_01686","Purchased"),shelfId:1,iconName:"__mdi:local_offer",newTabUrl:t("books/purchases")},toRead:{label:cjBasics.lang.i18n("cj_i18n_01690","To read"),shelfId:2,iconName:"__mdi:notifications",newTabUrl:o(2)},readingNow:{label:cjBasics.lang.i18n("cj_i18n_01687","Reading now"),shelfId:3,iconName:"__mdi:visibility",newTabUrl:o(3)},haveRead:{label:cjBasics.lang.i18n("cj_i18n_01688","Have read"),shelfId:4,iconName:"__mdi:history",newTabUrl:o(4)},reviewed:{label:cjBasics.lang.i18n("cj_i18n_01689","Reviewed"),shelfId:5,iconName:"__mdi:rate_review",newTabUrl:o(5)},recentlyViewed:{label:cjBasics.lang.i18n("cj_i18n_01691","Recently viewed"),shelfId:6,iconName:"__mdi:schedule",newTabUrl:o(6)},eBooks:{label:M?cjBasics.lang.i18n("cj_i18n_00807","My library"):cjBasics.lang.i18n("cj_i18n_01693","Ebooks"),shelfId:7,iconName:"__mdi:library_books",newTabUrl:t("books")},forYou:{label:M?cjBasics.lang.i18n("cj_i18n_01055","For you"):cjBasics.lang.i18n("cj_i18n_01684","Books for you"),shelfId:8,iconName:"__mdi:person",newTabUrl:M?t("store/books"):o(8)},browsingHistory:{label:cjBasics.lang.i18n("cj_i18n_01692","Browsing history"),shelfId:9,external:!0,iconName:"__mdi:history",newTabUrl:o(9)},audiobooks:{label:cjBasics.lang.i18n("cj_i18n_01678","Audiobooks"),external:!0,iconName:"__mdi:headset",newTabUrl:t("books/audiobooks")},play:{label:cjBasics.lang.i18n("cj_i18n_00134","Shop"),iconName:"__mdi:shop",newTabUrl:t("store/books"),divider:!0,external:cjBasics.navigator.vivaldi},uploads:{label:cjBasics.lang.i18n("cj_i18n_01680","Uploads"),external:!0,iconName:"__mdi:file_upload",newTabUrl:t("books/uploads")},rentals:{label:cjBasics.lang.i18n("cj_i18n_01682","Rentals"),external:!0,iconName:"__mdi:newsstand",newTabUrl:t("books/rentals")},samples:{label:cjBasics.lang.i18n("cj_i18n_01681","Samples"),external:!0,iconName:"__mdi:book",newTabUrl:t("books/samples")},family:{label:cjBasics.lang.i18n("cj_i18n_01219","Family"),external:!0,iconName:"__mdi:people",newTabUrl:t("books/family"),divider:!0},classicbooks:{label:cjBasics.lang.i18n("cj_i18n_01683","Classic Books"),iconName:"__mdi:collections_bookmark",newTabUrl:o(null)}};y()}});