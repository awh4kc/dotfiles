cjModules.define(function(){"use strict";var e="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser;return function(t,n){function r(e){return e?cjBasics.datetime.printDateString(e):cjBasics.lang.i18n("cj_i18n_00338","Now")}function a(e){return e?e.allTime.shortUrlClicks:"0"}function i(e){var t=mdElements.createElement("card",{interactive:!0,withPadding:!0});t.addEventListener("click",function(){n.openTab("https://goo.gl/#analytics/goo.gl/"+e.id.split("://goo.gl/")[1]+"/all_time")});var i=mdElements.createElement("title",{label:e.longUrl.split("?")[0]});i.classList.add("bm-p-urlshortener-resultcard__title"),t.appendChild(i);var l=mdElements.createElement("secondarytext",{label:cjBasics.lang.i18n("cj_i18n_00339","Short url")+": "}),s=document.createElement("a");s.addEventListener("click",function(e){e.stopPropagation(),n.openTab(s.href)}),s.textContent=e.id,s.href=e.id,l.appendChild(s),t.appendChild(l);var c=mdElements.createElement("secondarytext",{label:cjBasics.lang.i18n("cj_i18n_00340","Created")+": "+r(e.created)});t.appendChild(c);var o=mdElements.createElement("secondarytext",{label:cjBasics.lang.i18n("cj_i18n_00341","Click")+": "+a(e.analytics)});return t.appendChild(o),t}function l(){var e=cjBasics.urlParams.attach(y+"url/history",{projection:"ANALYTICS_CLICKS",fields:"items(analytics,created,id,longUrl)"});return cjgApis.request(e,{fetchAs:"json"},{account:n.account,requiredScopes:w}).then(function(e){return E=!0,e.items||[]},function(e){throw E=!1,new Error("Not signed in")})}function s(e){var t={method:"POST",fetchAs:"json",body:JSON.stringify({longUrl:e}),headers:{"Content-Type":"application/json"}},r=y+"url";return E?cjgApis.request(r,t,{account:n.account,requiredScopes:w}):cjBasics.ajax(r+"?key="+cjgApis.session.key,t)}function c(e){if(!e.startsWith("http://")&&!e.startsWith("https://")){var t=cjBasics.lang.i18n("cj_i18n_00050","Please fill in a valid URL"),n=new Error(t);return Promise.reject(n)}return s(e).then(function(t){if(!t.id){var n=cjBasics.lang.i18n("cj_i18n_00051","Error while generating short url");throw new Error(n)}if(E){var r=i(t);b.insertBefore(r,b.querySelector(".cj-md-card"))}return{shortUrl:t.id,longUrl:e}},function(){throw new Error("error while receiving a short url")})}function o(e){var n=document.createElement("div");n.classList.add("bm-p-urlshortener-resultcard");var r=document.createElement("div"),a=cjBasics.lang.i18n("cj_i18n_00048","Press CTRL-C to copy");cjBasics.navigator.mac&&(a=a.replace("CTRL","CMD")),r.dataset.tooltipText=a,r.className="bm-p-urlshortener-tooltip bm-p-urlshortener-tooltip--visible";var i=document.createElement("input");i.className="bm-p-urlshortener-resultcard__result",i.spellcheck=!1,i.readOnly=!0,i.value=e.shortUrl,i.addEventListener("blur",function(){r.classList.remove("bm-p-urlshortener-tooltip--visible")}),i.addEventListener("click",function(){r.classList.add("bm-p-urlshortener-tooltip--visible"),i.select()}),r.appendChild(i),n.appendChild(r);var l=mdElements.createElement("secondarytext",{label:cjBasics.lang.i18n("cj_i18n_00049","0 minutes ago")+" - "});l.classList.add("bm-p-urlshortener-resultcard__details");var s=document.createElement("a");s.className="bm-p-urlshortener-resultcard__analytics",s.textContent=cjBasics.lang.i18n("cj_i18n_01498","Analytics"),s.href="https://goo.gl/#analytics/goo.gl/"+e.shortUrl.split("://goo.gl/")[1].split("/")[0]+"/all_time",l.appendChild(s),n.appendChild(l);var c=document.createElement("div"),o=document.createElement("a");o.className="bm-p-urlshortener-resultcard__origin",o.href=e.longUrl,o.textContent=e.longUrl,c.appendChild(o),n.appendChild(c),j.textContent="",j.appendChild(n),bmElements.setLoading(t,!1),i.select()}function d(e){j.textContent="";var n=mdElements.createElement("subheader",{color:"#3367d6",label:e.message});j.appendChild(n),bmElements.setLoading(t,!1)}function u(e){bmElements.setLoading(t,!0),c(e).then(o,d)}function m(){E=!0,_.url&&u(_.url)}function p(){E=!1,_.url&&u(_.url);var e=bmElements.createElement("inlinepermission",{description:cjBasics.lang.i18n("cj_i18n_01156","Grant access to your Url Shortener data so we can list your shortened links here"),onClick:function(){cjgApis.auth.requestPermissions(n.account,w)}});b.appendChild(e),bmElements.setLoading(b,!1)}function h(){return l().then(function(e){e.forEach(function(e){var t=i(e);b.appendChild(t)}),bmElements.setLoading(b,!1)})}function g(){var e=mdElements.createElement("container",{darkMode:n.darkMode,scrollable:!0,shadow:"thinOnScroll"});j=document.createElement("div"),e.appendChild(j),b=document.createElement("div"),bmElements.setLoading(b,!0);var t=mdElements.createElement("subheader",{color:"#3367d6",label:cjBasics.lang.i18n("cj_i18n_00344","Previously shortened")});return b.appendChild(t),e.appendChild(b),e}function v(){_=cjBasics.urlParams.get(),_.url?C.value=_.url:e.tabs.query({currentWindow:!0,active:!0},function(e){var t=e[0],n=t.url;!n||n.startsWith("chrome:")||n.startsWith("about:")||n.startsWith("file:")||(C.value=t.url)})}function f(){var e=bmElements.createElement("ogb",{darkMode:n.darkMode,serviceIcon:"goo_gl",searchbox:{color:"#3367d6",iconName:"__mdi:link",onSubmit:u,label:cjBasics.lang.i18n("cj_i18n_00345","Enter a URL to shorten")},bmApis:n,onNewTab:function(){var e=cjgShortcuts.getUrl("152",n.account);n.openTab(e)}});t.appendChild(e),C=e.cjceSearchboxEle,n.onPageDisplay(function(){var e=t.querySelector(".bm-p-urlshortener-resultcard__result")||C;e.select()});var r=g();t.appendChild(r),v(),h().then(m,p)}var E,b,j,_,C,y="https://www.googleapis.com/urlshortener/v1/",w=["https://www.googleapis.com/auth/urlshortener"];f()}});