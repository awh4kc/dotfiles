!function(){"use strict";function e(e,a){var s="newtab"===w?"update":"create",n=!1;g.tabs.query({currentWindow:!0},function(t){for(var i=e.replace("/u/0/","/"),o=t.length;o>0;o--){var c=t[o-1],r=c.url;if("string"==typeof r&&(r.replace("/u/0/","/")===i||r.replace("/u/0/","/").split("?")[0].split("#")[0]===i)){g.tabs.update(c.id,{active:!0}),n=!0;break}}n||g.tabs[s]({url:e}),"popup"!==w||a||window.close()})}function a(a){a=a||{};var s=a.serviceData||{},n=cjgApis.session.account;return{darkMode:s.preferDarkMode?!b:f,theme:s.theme||"google",onPageDisplay:a.pageDisplayResolve,account:n,wizPath:cjgApis.session.wizPath,sid:u,hsb:cjBasics.navigator.preferNativeScrollbar?"1":null,openTab:e,environment:w,standaloneService:h,pageManager:j,userServices:bmBasics.userServices,servicesDatabase:l,ogbFeatures:{onNewTab:!0,notifications:h&&s.showNotifications&&n.validSession,accountchooser:h&&n.validSession,signin:h&&!n.validSession}}}function s(s){var n=mdElements.createElement("container");n.dataset.id=s.serviceId;var t=s.serviceData,i=t&&t.shortcutId,o=bmElements.createElement("fulldialog",{darkMode:f,bmApis:a({serviceData:t}),onNewTab:i?function(){var a=cjgShortcuts.getUrl(i,cjgApis.session.account);e(a)}:null,lockup:{label:t.label},iconName:t.iconName,message:s.message,actionLabel:s.actionLabel,action:s.action});n.appendChild(o),r.appendChild(n)}function n(e,n){var t=l[e],i=cjgApis.session.account,o=t.requireSignin&&!i.validSession;if(o)return void s({serviceId:e,serviceData:t,message:cjBasics.lang.i18n("cj_i18n_01557","To use this app, please sign in to your Google Account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01544","Sign in"),action:function(){cjgApis.account.signin(i)}});var c=i.pageId&&!t.brandAccount;if(c)return void s({serviceId:e,serviceData:t,message:cjBasics.lang.i18n("cj_i18n_01558","This app doesn't support Brand accounts, please switch to a different account"),actionLabel:cjBasics.lang.i18n("cj_i18n_01543","Switch account"),action:function(){j.navigate("accountchooser")}});var d;t.onPageDisplay=new Promise(function(e){d=e});var u=a({serviceData:t,pageDisplayResolve:d}),p=t.pageId||e,m=t.pageParameters,g=cjBasics.navigator.vivaldi&&t.vivaldiPageId;g&&(l[g]?p=g:(p="comingsoon",m={productId:e}));var v=bmElements.createElement("app",{pageId:p,bmApis:u,pageParameters:m,sessionParameters:n});v.dataset.id=e,r.appendChild(v)}function t(){r=document.createElement("div"),r.className="bm-ele-mainwindow",h||"newtab"===w||r.classList.add("bm-ele-mainwindow--sideportal"),"options"!==w&&d.then(function(){f&&r.classList.add("bm-ele-mainwindow--dark")}),"newtab"===w?r.classList.add("bm-ele-mainwindow--newtab"):"popup"===w&&r.classList.add("bm-ele-mainwindow--inpopup"),document.body.appendChild(r)}function i(e){var s=document.createElement("div");s.className="bm-ele-mainportal","newtab"!==w&&s.classList.add("bm-ele-mainportal--sideportal"),"newtab"===w?s.classList.add("bm-ele-mainportal--newtab"):"popup"===w&&s.classList.add("bm-ele-mainportal--inpopup"),document.body.appendChild(s),d.then(function(){b&&s.classList.add("bm-ele-mainportal--light")}),Promise.all([m,d,cjgApis.session.ready]).then(function(){var n=l[e],t=bmElements.createElement("app",{pageId:e,bmApis:a({serviceData:n})});s.appendChild(t)})}function o(){function e(){document.documentElement.classList.toggle("bm-ele-master--macfix"),a>0&&(setTimeout(e,s),a-=s)}var a=2750,s=250;e()}function c(){m=bmBasics.getServiceDatabase().then(function(e){return l=e,e}),d=browserStorage.sync.getItem("bm_pref__main__theme").then(function(e){"dark"===e?(f=!0,document.documentElement.classList.add("bm-master--dark")):"light"===e&&(b=!0)}),p=bmBasics.setWebrequests().then(function(e){u=e});var e=["search","gplus","translate","maps","youtube","news","gmail","drive","calendar","keep"];"newtab"===w&&(e=["chromtopsites","chromebookmarks","calendar","keep","news","drive","gmail","tasks","maps","contacts"]),bmBasics.userServices.init({debug:"1"===v.debug,defaultServices:e,accountRequest:cjgApis.session.ready,servicesDatabaseRequest:m}),g.runtime.onMessage.addListener(function(e){e.reloadAllInstances&&window.location.reload()}),g.runtime.sendMessage({cjLandingOpen:!0}),cjBasics.navigator.mac?cjBasics.navigator.firefox||"popup"!==w||(o(),g.runtime.sendMessage({closeAuthPopup:!0})):cjBasics.resources.loadStyle("styles/scrollbar.css"),cjBasics.navigator.firefox&&"popup"===w&&document.documentElement.classList.add("bm-ele-master--roundedpopup"),"options"===w&&cjBasics.navigator.firefox?document.documentElement.classList.add("bm-ele-master--autosize"):!cjBasics.navigator.firefoxMobile&&"newtab"!==w&&w||document.documentElement.classList.add("bm-ele-master--fullsize"),t(),h||i("newtab"===w?"newtab":"portal"),h&&"popup"===w&&i("accountchooser"),Promise.all([m,d,p,cjgApis.session.ready]).then(function(){h?j.navigate(h):bmBasics.userServices.getLastUsed().then(j.navigate)})}var r,l,d,u,p,m,g="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,v=cjBasics.urlParams.get(),b=!1,f=!1,h=v.page,w=v.environment,j=function(){function e(){t.forEach(function(e){e(i)}),o[i]||browserStorage.local.setItem("bm_cache_v05__portal__lastused",i)}function a(e){var a=r.querySelector(":scope > .selected"),s=a&&a.dataset.id||null;if(e!==s){var n=r.querySelector(':scope > [data-id="'+e+'"]');a&&a.classList.remove("selected"),n&&n.classList.add("selected")}}function s(s,t){var o=l[s];o.loaded||(o.loaded=!0,n(s,t)),i=s,a(i),e(),o.onPageDisplay&&o.onPageDisplay.then(function(e){s===i&&setTimeout(e)})}var t=[],i=h||"search",o={customize:!0,accountchooser:!0,removedialog:!0,portal:!0,newtab:!0};return{navigate:s,onChange:function(e){t.push(e),e(i)}}}();"popup"===w?window.addEventListener("load",function(){setTimeout(c,100)}):window.addEventListener("DOMContentLoaded",c)}();