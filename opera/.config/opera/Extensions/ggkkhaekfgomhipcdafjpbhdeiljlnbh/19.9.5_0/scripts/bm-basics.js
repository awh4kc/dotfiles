!function(){"use strict";function e(){var e=cjBasics.uniqueId.generate();return cjBasics.getTabId().then(function(r){return t.webRequest.onHeadersReceived.addListener(function(e){return{redirectUrl:"about:blank"}},{tabId:r,urls:["https://notifications.google.com/*widget*usegapi*"],types:["sub_frame"]},["blocking"]),t.webRequest.onHeadersReceived.addListener(function(e){var r=e.responseHeaders.filter(function(e){return"x-frame-options"!==e.name.toLowerCase()});return{responseHeaders:r}},{tabId:r,urls:["https://*.google.com/*bm_xfo="+e+"*"],types:["sub_frame"]},["blocking","responseHeaders"]),cjBasics.navigator.firefox&&t.webRequest.onHeadersReceived.addListener(function(e){var r=e.responseHeaders.filter(function(e){return"content-security-policy"!==e.name.toLowerCase()});return{responseHeaders:r}},{tabId:r,urls:["https://*.google.com/*bm_wiz="+e+"*"],types:["sub_frame"]},["blocking","responseHeaders"]),t.webRequest.onBeforeSendHeaders.addListener(function(e){for(var r=e.requestHeaders,t=0;t<r.length;t++){var n=r[t].name.toLowerCase();"user-agent"===n&&(r[t].value="Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Mobile Safari/537.36")}return{requestHeaders:r}},{tabId:r,urls:["https://*.google.com/*bm_mua="+e+"*"],types:["sub_frame"]},["blocking","requestHeaders"]),e})}function r(){return cjBasics.ajax("pages.json",{fetchAs:"json"}).then(function(e){return Object.keys(e).forEach(function(r){var t=e[r].labelI18n;t&&(e[r].label=cjBasics.lang.i18n(t,e[r].label))}),e})}var t="undefined"!=typeof chrome&&chrome.runtime?chrome:"undefined"!=typeof browser&&browser,n=function(){function e(e){b=[],p=[],Object.keys(g).forEach(function(r){var t=e.indexOf(r)!==-1,n=g[r].hidden;(!n||t&&"unused"===n||h&&"permanent"!==n)&&(t?b:p).push(r)}),b=b.sort(function(r,t){return e.indexOf(r)<e.indexOf(t)?-1:1}),p=p.sort(function(e,r){return g[e].label<g[r].label?-1:1})}function r(r){m=r.defaultServices||[],h=r.debug||!1,g=r.servicesDatabase||{};var t=Promise.all([browserStorage.local.getItem("bm_cache_v05__portal__lastused"),browserStorage.sync.getItem("bm_pref__portal__services"),r.servicesDatabaseRequest,r.accountRequest]).then(function(r){var t=_[r[0]]||r[0],n=r[1];if(g=r[2],u=r[3],f=t||n&&n[0]||"customize",!h&&u.pageId)return b=Object.keys(g).filter(function(e){return g[e].brandAccount&&!g[e].hidden}).sort(function(e,r){return y.indexOf(e)-y.indexOf(r)}),b.indexOf(f)===-1&&(f="aboutme"),null;if(!Array.isArray(n))return f=t||m[0],void e(m);var s=n.join(" ");Object.keys(_).forEach(function(e){var r=n.indexOf(e);r!==-1&&(n[r]=_[e])}),e(n),s!==b.join(" ")&&browserStorage.sync.setItem("bm_pref__portal__services",b)});d(t)}function t(){browserStorage.sync.setItem("bm_pref__portal__services",b),l.forEach(function(e){e(b,p)})}function n(e){v.then(function(){e(b,p)})}function s(r){e(r),t()}function o(r){var n=b.concat(r);e(n),t()}function a(){var r=Array.prototype.concat.apply([],arguments),n=b.filter(function(e){return r.indexOf(e)===-1});e(n),t()}function i(e){l.push(e),n(e)}function c(){return v.then(function(){return f})}var u,f,d,l=[],b=[],p=[],m=[],g={},h=!1,v=new Promise(function(e){d=e}),y=["aboutme","gplus","youtube","ytstudio","mybusiness","adwordsexpress","photos","albumarchive","myaccount"],_={webmastertools:"searchconsole",tiltbrushsketches:"poly",vrblocks:"poly",playmusic:"music",chromeapps:"browserapps",chromebookmarks:"browserbookmarks",chrometopsites:"browsertopsites",gmaillite:"gmail",calendarlite:"calendar",keeplite:"keep","keep-pro":"keep",googlepay:"gpay",payments:"gpay",adwords:"ads"};return{getLastUsed:c,get:n,set:s,add:o,remove:a,onChange:i,init:r}}();window.bmBasics={userServices:n,setWebrequests:e,getServiceDatabase:r}}();